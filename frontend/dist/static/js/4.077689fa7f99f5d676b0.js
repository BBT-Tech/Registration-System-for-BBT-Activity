webpackJsonp([4],{"R+vx":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={name:"ActivityCreator",components:{"input-tips":i("aAmI").a},data:function(){return{type:-1,title:"",details:"",time:"",number:0,inputType:1,same:0,numberList:[0,0,0,0,0,0,0,0,0,0],loading:!1}},watch:{same:function(){var t=this;t.numberList.forEach(function(e,i){t.$set(t.numberList,i,t.same)})},inputType:function(){1===this.inputType&&(this.same=this.numberList[0])}},computed:{isTitleValid:function(){return""!==this.title},isDetailsValid:function(){return""!==this.details},isTimeValid:function(){return""!==this.time&&this.$root.compareDatetime(this.time+":00")>0},isNumberValid:function(){return""!==this.number&&this.number>0&&this.number%1==0},isSameValid:function(){return this.same>=0&&this.same%1==0},isSumValid:function(){var t=0;return 1===this.inputType?t=10*this.same:2===this.inputType&&this.numberList.forEach(function(e){""!==e&&(t+=e)}),this.isNumberValid&&t>=this.number},isValid:function(){var t=this.isTitleValid&&this.isDetailsValid&&this.isTimeValid&&this.isNumberValid;return t?0===this.type?t:1===this.type?t&&this.isSumValid:void 0:t}},beforeCreate:function(){this.$root.logined||this.$root.$router.replace("/login"),this.$root.isManager||this.$root.$router.replace("/activity")},methods:{addActivity:function(){var t,e,i=this;i.loading=!0,0===i.type?(t="/api/manager/publish/volunteer",e={title:i.title,details:i.details,action_time:i.$root.inputToDatetime(i.time),member:i.number}):1===i.type&&(t="/api/manager/publish/award",e={title:i.title,details:i.details,book_time:i.$root.inputToDatetime(i.time),award:i.number,member_list:i.numberList}),i.$http.post(t,e).then(function(t){(t=t.body)instanceof Object?t.err_code?alert(t.err_msg):i.$root.$router.push("/activity/"+t.id):alert("服务器发生错误"),i.loading=!1}).catch(function(t){alert("404！该服务暂时不可用"),i.loading=!1})}}},n={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("button",{on:{click:function(e){t.$root.$router.push("/activity")}}},[t._v("返回")]),t._v(" "),i("br"),t._v("\n  活动类型："),i("select",{directives:[{name:"model",rawName:"v-model.number",value:t.type,expression:"type",modifiers:{number:!0}}],on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(e){var i="_value"in e?e._value:e.value;return t._n(i)});t.type=e.target.multiple?i:i[0]}}},[i("option",{attrs:{value:"0"}},[t._v("志愿者活动")]),t._v(" "),i("option",{attrs:{value:"1"}},[t._v("福利活动")])]),t._v(" "),0===t.type||1===t.type?i("div",[i("input-tips",{attrs:{"err-when":!t.isTitleValid},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}},[i("span",{attrs:{slot:"title"},slot:"title"},[t._v("标题：")]),t._v(" "),i("span",{attrs:{slot:"tips"},slot:"tips"},[t._v("标题不能为空")])]),t._v(" "),i("input-tips",{attrs:{"err-when":!t.isDetailsValid},model:{value:t.details,callback:function(e){t.details=e},expression:"details"}},[i("span",{attrs:{slot:"title"},slot:"title"},[t._v("详情：")]),t._v(" "),i("span",{attrs:{slot:"tips"},slot:"tips"},[t._v("详情不能为空")])]),t._v(" "),i("input-tips",{attrs:{type:"datetime-local","err-when":!t.isTimeValid},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}},[0===t.type?i("span",{attrs:{slot:"title"},slot:"title"},[t._v("志愿开始时间：")]):1===t.type?i("span",{attrs:{slot:"title"},slot:"title"},[t._v("福利领取时间：")]):t._e(),t._v(" "),""===t.time?i("span",{attrs:{slot:"tips"},slot:"tips"},[t._v("时间信息不全")]):i("span",{attrs:{slot:"tips"},slot:"tips"},[t._v("时间必须晚于当前")])]),t._v(" "),i("input-tips",{attrs:{type:"number","err-when":!t.isNumberValid},model:{value:t.number,callback:function(e){t.number=t._n(e)},expression:"number"}},[0===t.type?i("span",{attrs:{slot:"title"},slot:"title"},[t._v("限制人数：")]):1===t.type?i("span",{attrs:{slot:"title"},slot:"title"},[t._v("奖品总数：")]):t._e(),t._v(" "),i("span",{attrs:{slot:"tips"},slot:"tips"},[t._v("数量格式不正确")])]),t._v(" "),1===t.type?i("div",[t._v("\n      各部门人数限制："),i("select",{directives:[{name:"model",rawName:"v-model.number",value:t.inputType,expression:"inputType",modifiers:{number:!0}}],on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(e){var i="_value"in e?e._value:e.value;return t._n(i)});t.inputType=e.target.multiple?i:i[0]}}},[i("option",{attrs:{value:"1"}},[t._v("各部门相同")]),t._v(" "),i("option",{attrs:{value:"2"}},[t._v("自定义")])]),t._v(" "),1===t.inputType?i("div",[i("input-tips",{attrs:{type:"number","err-when":!t.isSameValid},model:{value:t.same,callback:function(e){t.same=t._n(e)},expression:"same"}},[i("span",{attrs:{slot:"title"},slot:"title"},[t._v("所有部门：")]),t._v(" "),i("span",{attrs:{slot:"tips"},slot:"tips"},[t._v("数量格式不正确")])])],1):2===t.inputType?i("div",t._l(t.numberList,function(e,s){return i("div",{key:"inputList"+s},[i("input-tips",{attrs:{type:"number","err-when":""===t.numberList[s]||t.numberList[s]<0||t.numberList[s]%1!=0},model:{value:t.numberList[s],callback:function(e){t.$set(t.numberList,s,t._n(e))},expression:"numberList[i]"}},[i("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.$root.departmentList[s])+"：")]),t._v(" "),i("span",{attrs:{slot:"tips"},slot:"tips"},[t._v("数量格式不正确")])])],1)})):t._e(),t._v(" "),t.isNumberValid&&!t.isSumValid?i("div",{staticClass:"error"},[t._v("限制总人数不小于奖品数")]):t._e()]):t._e()],1):t._e(),t._v(" "),t.isValid&&!t.loading?i("button",{on:{click:t.addActivity}},[t._v("添加活动")]):t._e(),t._v(" "),t.loading?i("div",[t._v("Loading...")]):t._e()])},staticRenderFns:[]};var a=i("VU/8")(s,n,!1,function(t){i("Xri8")},"data-v-6e4a05f1",null);e.default=a.exports},Xri8:function(t,e){}});
//# sourceMappingURL=4.077689fa7f99f5d676b0.js.map