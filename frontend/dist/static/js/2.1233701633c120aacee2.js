webpackJsonp([2],{GYYd:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a={name:"ActivityDepartment",props:["data"],data:function(){return{usedData:this.data,loading:!0,memberList:[],currentList:[]}},mounted:function(){this.getDepartmentInfo()},methods:{getDepartmentInfo:function(){var t=this;t.loading=!0,t.$http.post("/api/department.php",{id:t.usedData.id}).then(function(e){(e=e.body)instanceof Object?e.err_code?(alert(e.err_msg),t.$emit("fold")):(e=e.data,1===t.usedData.type&&(t.memberList=e.member_list),t.currentList=e.current_member_list):(alert("服务器发生错误"),t.$emit("fold")),t.loading=!1}).catch(function(e){alert("404！该服务暂时不可用"),t.loading=!1})}}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("h4",[t._v("各部门参与人数详情")]),t._v(" "),t.loading?i("div",[t._v("Loading...")]):i("div",[0===t.data.type?i("div",t._l(10,function(e){return i("div",{key:"department"+(e-1)},[t._v(t._s(t.$root.departmentList[e-1])+"："+t._s(t.currentList[e-1]))])})):1===t.data.type?i("div",t._l(10,function(e){return i("div",{key:"department"+(e-1)},[t._v(t._s(t.$root.departmentList[e-1])+"："+t._s(t.currentList[e-1])+"/"+t._s(t.memberList[e-1]))])})):t._e()])])},staticRenderFns:[]},n=i("VU/8")(a,r,!1,null,null,null).exports,s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"user-bar"},[i("div",[t._v("姓名："+t._s(t.data.name))]),t._v(" "),i("div",[t._v("学号："+t._s(t.data.student_id))]),t._v(" "),i("div",[t._v("部门："+t._s(t.data.department))]),t._v(" "),i("div",[t._v("手机："+t._s(t.data.tele))])])},staticRenderFns:[]};var d={name:"ActivityUser",props:["data"],components:{"activity-user-bar":i("VU/8")({name:"ActivityUserBar",props:["data"]},s,!1,function(t){i("ao1+")},"data-v-51779d76",null).exports},data:function(){return{currentStartOrd:0,queryNumber:3,isQueryEnd:!0,loading:!0,users:[]}},mounted:function(){this.getUserInfo()},methods:{getUserInfo:function(){var t=this;t.loading=!0,t.$http.post("/api/get-user-info.php",{start_ord:t.currentStartOrd,number:t.queryNumber}).then(function(e){(e=e.body)instanceof Object?e.err_code?(alert(e.err_msg),t.$emit("fold")):(e=e.data,t.users=t.users.concat(e.users),t.currentStartOrd+=e.users.length,t.isQueryEnd=e.is_end):(alert("服务器发生错误"),t.$emit("fold")),t.loading=!1}).catch(function(e){alert("404！该服务暂时不可用"),t.loading=!1})}}},o={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("h4",[t._v("参与用户列表")]),t._v(" "),t._l(t.users,function(t,e){return i("activity-user-bar",{key:"user"+e,attrs:{data:t}})}),t._v(" "),t.loading?i("div",[t._v("Loading...")]):t._e(),t._v(" "),t.loading||t.isQueryEnd?t._e():i("button",{on:{click:t.getUserInfo}},[t._v("查看更多")]),t._v(" "),!t.loading&&t.isQueryEnd&&0===t.currentStartOrd?i("div",[t._v("暂无用户参与")]):t._e()],2)},staticRenderFns:[]},c={name:"ActivityDetails",components:{"activity-department":n,"activity-user":i("VU/8")(d,o,!1,null,null,null).exports},data:function(){return{queryTypes:[{name:"各部门情况",type:1},{name:"参与人信息",type:2}],currentQueryType:0,isActivityExist:!0,timeAccess:!1,loading:!1,data:{}}},watch:{"$route.params.id":function(){this.getDetails()}},beforeCreate:function(){this.$root.logined||this.$root.$router.replace("/login")},created:function(){this.$root.logined&&this.getDetails()},methods:{back:function(){this.$root.$router.push("/activity")},getDetails:function(){var t=this;t.loading=!0,t.$http.post("/api/get-activity.php",{type:0,start_id:t.$route.params.id,number:1}).then(function(e){(e=e.body)instanceof Object?e.err_code?alert(e.err_msg):(e=e.data,t.isActivityExist=e.activities instanceof Array&&1===e.activities.length&&e.activities[0].id===Number(t.$route.params.id),t.isActivityExist?(t.data=e.activities[0],0===t.data.type?t.timeAccess=t.$root.compareDatetime(t.data.action_time)>=0:1===t.data.type&&(t.timeAccess=t.$root.compareDatetime(t.data.book_time)<0)):t.data={}):alert("服务器发生错误"),t.loading=!1}).catch(function(e){alert("404！该服务暂时不可用"),t.loaing=!1})},simplePost:function(t,e){this.$http.post(t+this.data.id).then(function(t){(t=t.body)instanceof Object?t.err_code&&alert(t.err_msg):alert("服务器发生错误"),void 0!==e&&e()}).catch(function(t){alert("404！该服务暂时不可用")})},register:function(){var t=this;t.simplePost("/api/user/register/",function(){t.getDetails()})},roll:function(){var t=this;t.simplePost("/api/publisher/roll/",function(){t.getDetails()})},delActivity:function(){var t=this;t.simplePost("/api/publisher/delete/",function(){t.$root.$router.replace("/activity")})},getFile:function(){this.simplePost("/api/manager/download/")}}},u={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",[i("button",{on:{click:t.back}},[t._v("返回")]),t._v(" "),t.isActivityExist&&!t.loading?i("div",[0===t.data.type?i("div",[i("h3",[t._v(t._s(t.data.title))]),t._v(" "),i("div",[t._v("类型：志愿者活动")]),t._v(" "),i("div",[t._v("详情："+t._s(t.data.details))]),t._v(" "),i("div",[t._v("志愿开始时间："+t._s(t.data.action_time))]),t._v(" "),i("div",[t._v("已报名人数："+t._s(t.data.current_member)+"/"+t._s(t.data.member))]),t._v(" "),i("div",[t._v("状态："),t.data.registered?i("span",[t._v("已报名")]):t.timeAccess?t.data.member===t.data.current_member?i("span",[t._v("报名人数已满")]):i("span",[t._v("可报名")]):i("span",[t._v("活动已开始，不予报名")])]),t._v(" "),t.timeAccess&&t.data.member>t.data.current_member&&!t.data.registered?i("button",{on:{click:t.register}},[t._v("报名")]):t._e(),t._v(" "),t.data.is_publisher?i("div",[i("button",{on:{click:t.roll}},[t._v("随机取满")]),t._v(" "),i("button",{on:{click:t.delActivity}},[t._v("删除")]),t._v(" "),t.timeAccess?i("button",{on:{click:function(e){t.$root.$router.push("/activity/"+t.data.id+"/edit")}}},[t._v("编辑")]):t._e()]):t._e()]):1===t.data.type?i("div",[i("h3",[t._v(t._s(t.data.title))]),t._v(" "),i("div",[t._v("类型：福利活动")]),t._v(" "),i("div",[t._v("详情："+t._s(t.data.details))]),t._v(" "),i("div",[t._v("领取时间："+t._s(t.data.book_time))]),t._v(" "),i("div",[t._v("已领取人数："+t._s(t.data.current_member)+"/"+t._s(t.data.award))]),t._v(" "),i("div",[t._v("状态："),t.data.registered?i("span",[t._v("已领奖")]):t.timeAccess?t.data.award===t.data.current_member?i("span",[t._v("奖品已被领完")]):t.data.is_department_full?i("span",[t._v("所在部门领取人数已满")]):i("span",[t._v("可领取")]):i("span",[t._v("领奖时间未到")])]),t._v(" "),t.timeAccess&&t.data.award>t.data.current_member&&!t.data.is_department_full&&!t.data.registered?i("button",{on:{click:t.register}},[t._v("领取")]):t._e(),t._v(" "),t.data.is_publisher?i("div",[i("button",{on:{click:t.delActivity}},[t._v("删除")]),t._v(" "),t.timeAccess?t._e():i("button",{on:{click:function(e){t.$root.$router.push("/activity/"+t.data.id+"/edit")}}},[t._v("编辑")])]):t._e()]):t._e(),t._v(" "),t.$root.isManager?i("div",[i("button",{on:{click:t.getFile}},[t._v("导出参与用户信息")]),t._v(" "),i("br"),t._v(" "),t._l(t.queryTypes,function(e){return i("span",{key:"queryDepartment"+e.type,staticClass:"button",class:{"button-active":e.type===t.currentQueryType},on:{click:function(i){t.currentQueryType=e.type}}},[t._v(t._s(e.name))])}),t._v(" "),1===t.currentQueryType?i("activity-department",{attrs:{data:t.data},on:{fold:function(e){t.currentQueryType=0}}}):t._e(),t._v(" "),2===t.currentQueryType?i("activity-user",{attrs:{data:t.data},on:{fold:function(e){t.currentQueryType=0}}}):t._e(),t._v(" "),i("br"),t._v(" "),0!==t.currentQueryType?i("button",{on:{click:function(e){t.currentQueryType=0}}},[t._v("收起")]):t._e()],2):t._e()]):t.isActivityExist||t.loading?t.loading?i("div",[t._v("Loading...")]):t._e():i("div",[i("h3",[t._v("你访问的活动已被删除")])])])])},staticRenderFns:[]};var _=i("VU/8")(c,u,!1,function(t){i("oz2d")},null,null);e.default=_.exports},"ao1+":function(t,e){},oz2d:function(t,e){}});
//# sourceMappingURL=2.1233701633c120aacee2.js.map