{"version":3,"sources":["webpack:///src/components/ActivityEditor.vue","webpack:///./src/components/ActivityEditor.vue?6272","webpack:///./src/components/ActivityEditor.vue","webpack:///./node_modules/babel-runtime/core-js/get-iterator.js","webpack:///./node_modules/core-js/library/fn/get-iterator.js","webpack:///./node_modules/core-js/library/modules/core.get-iterator.js"],"names":["ActivityEditor","name","components","input-tips","data","id","type","title","inputType","same","isListEdited","prev","details","time","number","numberList","crn","loading","saving","watch","this","toSame","computed","isDetailsValid","isTimeValid","$root","compareDatetime","isNumberValid","isSameValid","isSumValid","sum","forEach","value","isValid","vm","edited","beforeCreate","logined","$router","replace","isManager","$route","params","created","checkActivity","methods","index","$set","checkList","i","back","push","saveActivity","url","send","action_time","inputToDatetime","member","book_time","award","member_list","$http","post","then","body","Object","err_code","alert","err_msg","catch","start_id","promise_default","a","reject","activities","Array","length","Number","activity","timeAccess","is_publisher","datetimeToInput","slice","lastValue","isSame","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","get_iterator_default","next","done","err","return","components_ActivityEditor","render","_vm","_h","$createElement","_c","_self","on","click","_v","_e","_s","attrs","err-when","model","callback","$$v","expression","slot","_n","directives","rawName","modifiers","change","$event","$$selectedVal","prototype","filter","call","target","options","o","selected","map","val","_value","multiple","input","_l","j","key","departmentList","staticClass","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__","module","exports","default","__esModule","anObject","get","getIterator","it","iterFn","TypeError"],"mappings":"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","file":"static/js/1.42d9e6838e80a3eab39b.js","sourcesContent":["<template>\r\n  <div>\r\n    <button v-on:click=\"back\">返回</button>\r\n    <div v-if=\"loading\">\r\n      <div v-if=\"type === 0\">类型：志愿者活动</div>\r\n      <div v-else-if=\"type === 1\">类型：福利活动</div>\r\n      <div>标题：{{ title }}</div>\r\n      <input-tips v-model=\"crn.details\" v-bind:err-when=\"!isDetailsValid\">\r\n        <span slot=\"title\">详情：</span>\r\n        <span slot=\"tips\">详情不能为空</span>\r\n      </input-tips>\r\n      <input-tips type=\"datetime-local\" v-model=\"crn.time\" v-bind:err-when=\"!isTimeValid\">\r\n        <span slot=\"title\" v-if=\"type === 0\">志愿开始时间：</span>\r\n        <span slot=\"title\" v-else-if=\"type === 1\">福利领取时间：</span>\r\n        <span slot=\"tips\" v-if=\"crn.time === ''\">时间信息不全</span>\r\n        <span slot=\"tips\" v-else>时间必须晚于当前</span>\r\n      </input-tips>\r\n      <input-tips type=\"number\" v-model.number=\"crn.number\" v-bind:err-when=\"!isNumberValid\">\r\n        <span slot=\"title\" v-if=\"type === 0\">限制人数：</span>\r\n        <span slot=\"title\" v-else-if=\"type === 1\">奖品总数：</span>\r\n        <span slot=\"tips\">数量格式不正确</span>\r\n      </input-tips>\r\n      <div v-if=\"type === 1\">\r\n        各部门人数限制：<select v-model.number=\"inputType\">\r\n          <option value=\"1\">各部门相同</option>\r\n          <option value=\"2\">自定义</option>\r\n        </select>\r\n        <div v-if=\"inputType === 1\">\r\n          <input-tips\r\n            type=\"number\"\r\n            v-on:input=\"checkList(toSame(same = Number($event)))\"\r\n            v-bind:value=\"same\"\r\n            v-bind:err-when=\"!isSameValid\"\r\n          >\r\n            <span slot=\"title\">所有部门：</span>\r\n            <span slot=\"tips\">数量格式不正确</span>\r\n          </input-tips>\r\n        </div>\r\n        <div v-else-if=\"inputType === 2\">\r\n          <div v-for=\"(j, i) in crn.numberList\" v-bind:key=\"'inputList' + i\">\r\n            <input-tips\r\n              type=\"number\"\r\n              v-on:input=\"checkList($set(crn.numberList, i, Number($event)))\"\r\n              v-bind:value=\"crn.numberList[i]\"\r\n              v-bind:err-when=\"crn.numberList[i] === '' ||\r\n                crn.numberList[i] < 0 ||\r\n                crn.numberList[i] % 1 !== 0\"\r\n            >\r\n              <span slot=\"title\">{{ $root.departmentList[i] }}：</span>\r\n              <span slot=\"tips\">数量格式不正确</span>\r\n            </input-tips>\r\n          </div>\r\n        </div>\r\n        <div class=\"error\" v-if=\"isNumberValid && !isSumValid\">限制总人数不小于奖品数</div>\r\n      </div>\r\n      <button v-if=\"edited && isValid && !saving\" v-on:click=\"saveActivity\">保存</button>\r\n      <div v-if=\"saving\">Loading...</div>\r\n    </div>\r\n    <div v-else>Loading...</div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport InputTips from './InputTips.vue'\r\nexport default {\r\n  name: 'ActivityEditor',\r\n  components: {'input-tips': InputTips},\r\n  data () {\r\n    return {\r\n      id: 0,\r\n      type: -1,\r\n      title: '',\r\n      inputType: 1,\r\n      same: 0,\r\n      isListEdited: false,\r\n      prev: {\r\n        details: '',\r\n        time: '',\r\n        number: 0,\r\n        numberList: []\r\n      },\r\n      crn: {\r\n        details: '',\r\n        time: '',\r\n        number: 0,\r\n        numberList: []\r\n      },\r\n      loading: false,\r\n      saving: false\r\n    }\r\n  },\r\n  watch: {\r\n    inputType () {\r\n      var vm = this\r\n      if (vm.inputType === 1) {\r\n        vm.same = vm.crn.numberList[0]\r\n        vm.toSame()\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    isDetailsValid () {\r\n      return this.crn.details !== ''\r\n    },\r\n    isTimeValid () {\r\n      return this.time !== '' &&\r\n        this.$root.compareDatetime(this.crn.time + ':00') > 0\r\n    },\r\n    isNumberValid () {\r\n      return this.crn.number > 0 &&\r\n        this.crn.number % 1 === 0\r\n    },\r\n    isSameValid () {\r\n      return this.same >= 0 &&\r\n        this.same % 1 === 0\r\n    },\r\n    isSumValid () {\r\n      var sum = 0\r\n      if (this.inputType === 1) {\r\n        sum = this.same * 10\r\n      } else if (this.inputType === 2) {\r\n        this.crn.numberList.forEach(value => {\r\n          if (value !== '') {\r\n            sum += value\r\n          }\r\n        })\r\n      }\r\n      return this.isNumberValid && sum >= this.crn.number\r\n    },\r\n    isValid () {\r\n      var vm = this\r\n      var isValid = vm.isDetailsValid &&\r\n        vm.isTimeValid &&\r\n        vm.isNumberValid\r\n      if (!isValid) {\r\n        return isValid\r\n      }\r\n      if (vm.type === 0) {\r\n        return isValid\r\n      } else if (vm.type === 1) {\r\n        return isValid && vm.isSumValid\r\n      }\r\n    },\r\n    edited () {\r\n      var vm = this\r\n      var edited = vm.crn.details !== vm.prev.details ||\r\n        vm.crn.time !== vm.prev.time ||\r\n        vm.crn.number !== vm.prev.number\r\n      if (vm.type === 0) {\r\n        return edited\r\n      } else if (vm.type === 1) {\r\n        return edited || vm.isListEdited\r\n      }\r\n    }\r\n  },\r\n  beforeCreate () {\r\n    if (!this.$root.logined) {\r\n      this.$root.$router.replace('/login')\r\n    }\r\n    if (!this.$root.isManager) {\r\n      this.$root.$router.replace('/activity/' + this.$route.params.id)\r\n    }\r\n  },\r\n  created () {\r\n    if (this.$root.logined && this.$root.isManager) {\r\n      this.checkActivity()\r\n    }\r\n  },\r\n  methods: {\r\n    toSame () {\r\n      var vm = this\r\n      vm.crn.numberList.forEach((value, index) => {\r\n        vm.$set(vm.crn.numberList, index, vm.same)\r\n      })\r\n    },\r\n    checkList () {\r\n      var vm = this\r\n      if (vm.type === 1) {\r\n        let i\r\n        for (i = 0; i < 10; i++) {\r\n          if (vm.prev.numberList[i] !== vm.crn.numberList[i]) {\r\n            vm.isListEdited = true\r\n            return\r\n          }\r\n        }\r\n      }\r\n      vm.isListEdited = false\r\n    },\r\n    back () {\r\n      this.$root.$router.push('/activity/' + this.$route.params.id)\r\n    },\r\n    saveActivity () {\r\n      var vm = this\r\n      var url, send\r\n      vm.saving = true\r\n      if (vm.type === 0) {\r\n        url = '/api/publisher/modify/volunteer/' + vm.$route.params.id\r\n        send = {\r\n          details: vm.crn.details,\r\n          action_time: vm.$root.inputToDatetime(vm.crn.time),\r\n          member: vm.crn.number\r\n        }\r\n      } else if (vm.type === 1) {\r\n        url = '/api/publisher/modify/award/' + vm.$route.params.id\r\n        send = {\r\n          details: vm.crn.details,\r\n          book_time: vm.$root.inputToDatetime(vm.crn.time),\r\n          award: vm.crn.number,\r\n          member_list: vm.crn.numberList\r\n        }\r\n      }\r\n      vm.$http.post(url, send).then(data => {\r\n        data = data.body\r\n        if (!(data instanceof Object)) {\r\n          alert('服务器发生错误')\r\n        } else if (data.err_code) {\r\n          alert(data.err_msg)\r\n        } else {\r\n          vm.$root.$router.push('/activity/' + vm.$route.params.id)\r\n        }\r\n        vm.saving = false\r\n      }).catch(data => {\r\n        alert('404！该服务暂时不可用')\r\n        vm.saving = false\r\n      })\r\n    },\r\n    checkActivity () {\r\n      var vm = this\r\n      vm.$http.post('/api/get-activity.php', {\r\n        type: 0,\r\n        start_id: vm.$route.params.id,\r\n        number: 1\r\n      }).then(data => {\r\n        data = data.body\r\n        if (!(data instanceof Object)) {\r\n          return Promise.reject('服务器发生错误')\r\n        } else if (data.err_code) {\r\n          return Promise.reject(data.err_msg)\r\n        } else {\r\n          data = data.data\r\n          if (data.activities instanceof Array &&\r\n            data.activities.length === 1 &&\r\n            data.activities[0].id === Number(vm.$route.params.id)) {\r\n            let activity = data.activities[0]\r\n            let timeAccess = false\r\n            if (activity.type === 0) {\r\n              timeAccess = vm.$root.compareDatetime(activity.action_time) > 0\r\n            } else if (activity.type === 1) {\r\n              timeAccess = vm.$root.compareDatetime(activity.book_time) > 0\r\n            }\r\n            if (!(timeAccess && activity.is_publisher)) {\r\n              return Promise.reject('你没有修改权限')\r\n            }\r\n            vm.id = activity.id\r\n            vm.type = activity.type\r\n            vm.title = vm.title = activity.title\r\n            vm.prev.details = vm.crn.details = activity.details\r\n            if (vm.type === 0) {\r\n              vm.prev.time = vm.crn.time = vm.$root.datetimeToInput(activity.action_time)\r\n              vm.prev.number = vm.crn.number = activity.member\r\n              return Promise.reject(0)\r\n            } else if (vm.type === 1) {\r\n              vm.prev.time = vm.crn.time = vm.$root.datetimeToInput(activity.book_time)\r\n              vm.prev.number = vm.crn.number = activity.award\r\n              return vm.$http.post('/api/department.php', {id: vm.id})\r\n            }\r\n          } else {\r\n            return Promise.reject('活动不存在')\r\n          }\r\n        }\r\n      }).then(data => {\r\n        data = data.body\r\n        if (!(data instanceof Object)) {\r\n          return Promise.reject('服务器发生错误')\r\n        } else if (data.err_code) {\r\n          return Promise.reject(data.err_msg)\r\n        } else {\r\n          data = data.data\r\n          vm.prev.numberList = data.member_list.slice()\r\n          vm.crn.numberList = data.member_list.slice()\r\n          let lastValue = data.member_list[0]\r\n          let isSame = true\r\n          for (let value of vm.crn.numberList) {\r\n            if (lastValue !== value) {\r\n              vm.inputType = 2\r\n              isSame = false\r\n              break\r\n            }\r\n            lastValue = value\r\n          }\r\n          if (isSame) {\r\n            vm.same = data.member_list[0]\r\n          }\r\n          return Promise.reject(0)\r\n        }\r\n      }).catch(data => {\r\n        // console.log(data.construtor)\r\n        if (data === 0) {\r\n          vm.loading = true\r\n          return\r\n        } else if (typeof data === 'string') {\r\n          alert(data)\r\n        } else {\r\n          alert('服务器发生错误')\r\n        }\r\n        vm.$root.$router.replace('/activity/' + vm.$route.params.id)\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.error {\r\n  color: #ff0000\r\n}\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/components/ActivityEditor.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('button',{on:{\"click\":_vm.back}},[_vm._v(\"返回\")]),_vm._v(\" \"),(_vm.loading)?_c('div',[(_vm.type === 0)?_c('div',[_vm._v(\"类型：志愿者活动\")]):(_vm.type === 1)?_c('div',[_vm._v(\"类型：福利活动\")]):_vm._e(),_vm._v(\" \"),_c('div',[_vm._v(\"标题：\"+_vm._s(_vm.title))]),_vm._v(\" \"),_c('input-tips',{attrs:{\"err-when\":!_vm.isDetailsValid},model:{value:(_vm.crn.details),callback:function ($$v) {_vm.$set(_vm.crn, \"details\", $$v)},expression:\"crn.details\"}},[_c('span',{attrs:{\"slot\":\"title\"},slot:\"title\"},[_vm._v(\"详情：\")]),_vm._v(\" \"),_c('span',{attrs:{\"slot\":\"tips\"},slot:\"tips\"},[_vm._v(\"详情不能为空\")])]),_vm._v(\" \"),_c('input-tips',{attrs:{\"type\":\"datetime-local\",\"err-when\":!_vm.isTimeValid},model:{value:(_vm.crn.time),callback:function ($$v) {_vm.$set(_vm.crn, \"time\", $$v)},expression:\"crn.time\"}},[(_vm.type === 0)?_c('span',{attrs:{\"slot\":\"title\"},slot:\"title\"},[_vm._v(\"志愿开始时间：\")]):(_vm.type === 1)?_c('span',{attrs:{\"slot\":\"title\"},slot:\"title\"},[_vm._v(\"福利领取时间：\")]):_vm._e(),_vm._v(\" \"),(_vm.crn.time === '')?_c('span',{attrs:{\"slot\":\"tips\"},slot:\"tips\"},[_vm._v(\"时间信息不全\")]):_c('span',{attrs:{\"slot\":\"tips\"},slot:\"tips\"},[_vm._v(\"时间必须晚于当前\")])]),_vm._v(\" \"),_c('input-tips',{attrs:{\"type\":\"number\",\"err-when\":!_vm.isNumberValid},model:{value:(_vm.crn.number),callback:function ($$v) {_vm.$set(_vm.crn, \"number\", _vm._n($$v))},expression:\"crn.number\"}},[(_vm.type === 0)?_c('span',{attrs:{\"slot\":\"title\"},slot:\"title\"},[_vm._v(\"限制人数：\")]):(_vm.type === 1)?_c('span',{attrs:{\"slot\":\"title\"},slot:\"title\"},[_vm._v(\"奖品总数：\")]):_vm._e(),_vm._v(\" \"),_c('span',{attrs:{\"slot\":\"tips\"},slot:\"tips\"},[_vm._v(\"数量格式不正确\")])]),_vm._v(\" \"),(_vm.type === 1)?_c('div',[_vm._v(\"\\n      各部门人数限制：\"),_c('select',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.inputType),expression:\"inputType\",modifiers:{\"number\":true}}],on:{\"change\":function($event){var $$selectedVal = Array.prototype.filter.call($event.target.options,function(o){return o.selected}).map(function(o){var val = \"_value\" in o ? o._value : o.value;return _vm._n(val)}); _vm.inputType=$event.target.multiple ? $$selectedVal : $$selectedVal[0]}}},[_c('option',{attrs:{\"value\":\"1\"}},[_vm._v(\"各部门相同\")]),_vm._v(\" \"),_c('option',{attrs:{\"value\":\"2\"}},[_vm._v(\"自定义\")])]),_vm._v(\" \"),(_vm.inputType === 1)?_c('div',[_c('input-tips',{attrs:{\"type\":\"number\",\"value\":_vm.same,\"err-when\":!_vm.isSameValid},on:{\"input\":function($event){_vm.checkList(_vm.toSame(_vm.same = Number($event)))}}},[_c('span',{attrs:{\"slot\":\"title\"},slot:\"title\"},[_vm._v(\"所有部门：\")]),_vm._v(\" \"),_c('span',{attrs:{\"slot\":\"tips\"},slot:\"tips\"},[_vm._v(\"数量格式不正确\")])])],1):(_vm.inputType === 2)?_c('div',_vm._l((_vm.crn.numberList),function(j,i){return _c('div',{key:'inputList' + i},[_c('input-tips',{attrs:{\"type\":\"number\",\"value\":_vm.crn.numberList[i],\"err-when\":_vm.crn.numberList[i] === '' ||\n              _vm.crn.numberList[i] < 0 ||\n              _vm.crn.numberList[i] % 1 !== 0},on:{\"input\":function($event){_vm.checkList(_vm.$set(_vm.crn.numberList, i, Number($event)))}}},[_c('span',{attrs:{\"slot\":\"title\"},slot:\"title\"},[_vm._v(_vm._s(_vm.$root.departmentList[i])+\"：\")]),_vm._v(\" \"),_c('span',{attrs:{\"slot\":\"tips\"},slot:\"tips\"},[_vm._v(\"数量格式不正确\")])])],1)})):_vm._e(),_vm._v(\" \"),(_vm.isNumberValid && !_vm.isSumValid)?_c('div',{staticClass:\"error\"},[_vm._v(\"限制总人数不小于奖品数\")]):_vm._e()]):_vm._e(),_vm._v(\" \"),(_vm.edited && _vm.isValid && !_vm.saving)?_c('button',{on:{\"click\":_vm.saveActivity}},[_vm._v(\"保存\")]):_vm._e(),_vm._v(\" \"),(_vm.saving)?_c('div',[_vm._v(\"Loading...\")]):_vm._e()],1):_c('div',[_vm._v(\"Loading...\")])])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-2c9d9abc\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/ActivityEditor.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-2c9d9abc\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./ActivityEditor.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./ActivityEditor.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./ActivityEditor.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-2c9d9abc\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./ActivityEditor.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-2c9d9abc\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/ActivityEditor.vue\n// module id = null\n// module chunks = ","module.exports = { \"default\": require(\"core-js/library/fn/get-iterator\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/babel-runtime/core-js/get-iterator.js\n// module id = BO1k\n// module chunks = 1","require('../modules/web.dom.iterable');\nrequire('../modules/es6.string.iterator');\nmodule.exports = require('../modules/core.get-iterator');\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/library/fn/get-iterator.js\n// module id = fxRn\n// module chunks = 1","var anObject = require('./_an-object');\nvar get = require('./core.get-iterator-method');\nmodule.exports = require('./_core').getIterator = function (it) {\n  var iterFn = get(it);\n  if (typeof iterFn != 'function') throw TypeError(it + ' is not iterable!');\n  return anObject(iterFn.call(it));\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/library/modules/core.get-iterator.js\n// module id = g8Ux\n// module chunks = 1"],"sourceRoot":""}