webpackJsonp([1],{"1Qci":function(t,e){},"1UK+":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i("BO1k"),n=i.n(r),s=i("//Fk"),a=i.n(s),o={name:"ActivityEditor",components:{"input-tips":i("aAmI").a},data:function(){return{id:0,type:-1,title:"",inputType:1,same:0,isListEdited:!1,prev:{details:"",time:"",number:0,numberList:[]},crn:{details:"",time:"",number:0,numberList:[]},loading:!1,saving:!1}},watch:{inputType:function(){1===this.inputType&&(this.same=this.crn.numberList[0],this.toSame())}},computed:{isDetailsValid:function(){return""!==this.crn.details},isTimeValid:function(){return""!==this.time&&this.$root.compareDatetime(this.crn.time+":00")>0},isNumberValid:function(){return this.crn.number>0&&this.crn.number%1==0},isSameValid:function(){return this.same>=0&&this.same%1==0},isSumValid:function(){var t=0;return 1===this.inputType?t=10*this.same:2===this.inputType&&this.crn.numberList.forEach(function(e){""!==e&&(t+=e)}),this.isNumberValid&&t>=this.crn.number},isValid:function(){var t=this,e=t.isDetailsValid&&t.isTimeValid&&t.isNumberValid;return e?0===t.type?e:1===t.type?e&&t.isSumValid:void 0:e},edited:function(){var t=this,e=t.crn.details!==t.prev.details||t.crn.time!==t.prev.time||t.crn.number!==t.prev.number;return 0===t.type?e:1===t.type?e||t.isListEdited:void 0}},beforeCreate:function(){this.$root.logined||this.$root.$router.replace("/login"),this.$root.isManager||this.$root.$router.replace("/activity/"+this.$route.params.id)},created:function(){this.$root.logined&&this.$root.isManager&&this.checkActivity()},methods:{toSame:function(){var t=this;t.crn.numberList.forEach(function(e,i){t.$set(t.crn.numberList,i,t.same)})},checkList:function(){var t=this;if(1===t.type){var e=void 0;for(e=0;e<10;e++)if(t.prev.numberList[e]!==t.crn.numberList[e])return void(t.isListEdited=!0)}t.isListEdited=!1},back:function(){this.$root.$router.push("/activity/"+this.$route.params.id)},saveActivity:function(){var t,e,i=this;i.saving=!0,0===i.type?(t="/api/publisher/modify/volunteer/"+i.$route.params.id,e={details:i.crn.details,action_time:i.$root.inputToDatetime(i.crn.time),member:i.crn.number}):1===i.type&&(t="/api/publisher/modify/award/"+i.$route.params.id,e={details:i.crn.details,book_time:i.$root.inputToDatetime(i.crn.time),award:i.crn.number,member_list:i.crn.numberList}),i.$http.post(t,e).then(function(t){(t=t.body)instanceof Object?t.err_code?alert(t.err_msg):i.$root.$router.push("/activity/"+i.$route.params.id):alert("服务器发生错误"),i.saving=!1}).catch(function(t){alert("404！该服务暂时不可用"),i.saving=!1})},checkActivity:function(){var t=this;t.$http.post("/api/get-activity.php",{type:0,start_id:t.$route.params.id,number:1}).then(function(e){if(!((e=e.body)instanceof Object))return a.a.reject("服务器发生错误");if(e.err_code)return a.a.reject(e.err_msg);if(!((e=e.data).activities instanceof Array&&1===e.activities.length&&e.activities[0].id===Number(t.$route.params.id)))return a.a.reject("活动不存在");var i=e.activities[0],r=!1;return 0===i.type?r=t.$root.compareDatetime(i.action_time)>0:1===i.type&&(r=t.$root.compareDatetime(i.book_time)>0),r&&i.is_publisher?(t.id=i.id,t.type=i.type,t.title=t.title=i.title,t.prev.details=t.crn.details=i.details,0===t.type?(t.prev.time=t.crn.time=t.$root.datetimeToInput(i.action_time),t.prev.number=t.crn.number=i.member,a.a.reject(0)):1===t.type?(t.prev.time=t.crn.time=t.$root.datetimeToInput(i.book_time),t.prev.number=t.crn.number=i.award,t.$http.post("/api/department.php",{id:t.id})):void 0):a.a.reject("你没有修改权限")}).then(function(e){if((e=e.body)instanceof Object){if(e.err_code)return a.a.reject(e.err_msg);e=e.data,t.prev.numberList=e.member_list.slice(),t.crn.numberList=e.member_list.slice();var i=e.member_list[0],r=!0,s=!0,o=!1,u=void 0;try{for(var c,l=n()(t.crn.numberList);!(s=(c=l.next()).done);s=!0){var p=c.value;if(i!==p){t.inputType=2,r=!1;break}i=p}}catch(t){o=!0,u=t}finally{try{!s&&l.return&&l.return()}finally{if(o)throw u}}return r&&(t.same=e.member_list[0]),a.a.reject(0)}return a.a.reject("服务器发生错误")}).catch(function(e){0!==e?("string"==typeof e?alert(e):alert("服务器发生错误"),t.$root.$router.replace("/activity/"+t.$route.params.id)):t.loading=!0})}}},u={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("button",{on:{click:t.back}},[t._v("返回")]),t._v(" "),t.loading?i("div",[0===t.type?i("div",[t._v("类型：志愿者活动")]):1===t.type?i("div",[t._v("类型：福利活动")]):t._e(),t._v(" "),i("div",[t._v("标题："+t._s(t.title))]),t._v(" "),i("input-tips",{attrs:{"err-when":!t.isDetailsValid},model:{value:t.crn.details,callback:function(e){t.$set(t.crn,"details",e)},expression:"crn.details"}},[i("span",{attrs:{slot:"title"},slot:"title"},[t._v("详情：")]),t._v(" "),i("span",{attrs:{slot:"tips"},slot:"tips"},[t._v("详情不能为空")])]),t._v(" "),i("input-tips",{attrs:{type:"datetime-local","err-when":!t.isTimeValid},model:{value:t.crn.time,callback:function(e){t.$set(t.crn,"time",e)},expression:"crn.time"}},[0===t.type?i("span",{attrs:{slot:"title"},slot:"title"},[t._v("志愿开始时间：")]):1===t.type?i("span",{attrs:{slot:"title"},slot:"title"},[t._v("福利领取时间：")]):t._e(),t._v(" "),""===t.crn.time?i("span",{attrs:{slot:"tips"},slot:"tips"},[t._v("时间信息不全")]):i("span",{attrs:{slot:"tips"},slot:"tips"},[t._v("时间必须晚于当前")])]),t._v(" "),i("input-tips",{attrs:{type:"number","err-when":!t.isNumberValid},model:{value:t.crn.number,callback:function(e){t.$set(t.crn,"number",t._n(e))},expression:"crn.number"}},[0===t.type?i("span",{attrs:{slot:"title"},slot:"title"},[t._v("限制人数：")]):1===t.type?i("span",{attrs:{slot:"title"},slot:"title"},[t._v("奖品总数：")]):t._e(),t._v(" "),i("span",{attrs:{slot:"tips"},slot:"tips"},[t._v("数量格式不正确")])]),t._v(" "),1===t.type?i("div",[t._v("\n      各部门人数限制："),i("select",{directives:[{name:"model",rawName:"v-model.number",value:t.inputType,expression:"inputType",modifiers:{number:!0}}],on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(e){var i="_value"in e?e._value:e.value;return t._n(i)});t.inputType=e.target.multiple?i:i[0]}}},[i("option",{attrs:{value:"1"}},[t._v("各部门相同")]),t._v(" "),i("option",{attrs:{value:"2"}},[t._v("自定义")])]),t._v(" "),1===t.inputType?i("div",[i("input-tips",{attrs:{type:"number",value:t.same,"err-when":!t.isSameValid},on:{input:function(e){t.checkList(t.toSame(t.same=Number(e)))}}},[i("span",{attrs:{slot:"title"},slot:"title"},[t._v("所有部门：")]),t._v(" "),i("span",{attrs:{slot:"tips"},slot:"tips"},[t._v("数量格式不正确")])])],1):2===t.inputType?i("div",t._l(t.crn.numberList,function(e,r){return i("div",{key:"inputList"+r},[i("input-tips",{attrs:{type:"number",value:t.crn.numberList[r],"err-when":""===t.crn.numberList[r]||t.crn.numberList[r]<0||t.crn.numberList[r]%1!=0},on:{input:function(e){t.checkList(t.$set(t.crn.numberList,r,Number(e)))}}},[i("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.$root.departmentList[r])+"：")]),t._v(" "),i("span",{attrs:{slot:"tips"},slot:"tips"},[t._v("数量格式不正确")])])],1)})):t._e(),t._v(" "),t.isNumberValid&&!t.isSumValid?i("div",{staticClass:"error"},[t._v("限制总人数不小于奖品数")]):t._e()]):t._e(),t._v(" "),t.edited&&t.isValid&&!t.saving?i("button",{on:{click:t.saveActivity}},[t._v("保存")]):t._e(),t._v(" "),t.saving?i("div",[t._v("Loading...")]):t._e()],1):i("div",[t._v("Loading...")])])},staticRenderFns:[]};var c=i("VU/8")(o,u,!1,function(t){i("1Qci")},"data-v-2c9d9abc",null);e.default=c.exports},BO1k:function(t,e,i){t.exports={default:i("fxRn"),__esModule:!0}},fxRn:function(t,e,i){i("+tPU"),i("zQR9"),t.exports=i("g8Ux")},g8Ux:function(t,e,i){var r=i("77Pl"),n=i("3fs2");t.exports=i("FeBl").getIterator=function(t){var e=n(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return r(e.call(t))}}});
//# sourceMappingURL=1.42d9e6838e80a3eab39b.js.map